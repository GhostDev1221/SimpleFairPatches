---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Administrator.
--- DateTime: 2018/9/18 10:28
---

GameExGunNpc = class()

function GameExGunNpc:ctor(config)
    self.entityId = 0
    self.itemId = config.itemId
    self.buyHint = config.buyHint
    self.vec3 = VectorUtil.newVector3(config.x, config.y, config.z)
    self.actor = config.actor
    self.yaw = config.yaw
    self.itemNum = config.itemNum
    self.gunName = config.gunName
    self.isGun = config.isGun
    self.isSprayPaint = config.isSprayPaint
    self:onCreate()
end

function GameExGunNpc:onCreate()
    self.entityId = EngineWorld:addActorNpc(self.vec3, self.yaw, self.actor, self.gunName, "idle")
    GameManager:onAddExGunNpc(self)
end

function GameExGunNpc:onPlayerHit(player)
    if player:getItemNumById(self.itemId) == 0 then
        if self.isGun == 1 then
            if self.isSprayPaint == 1 then
                if player.gunSprayPaints[tostring(self.itemId)] then
                    player:addGunItem(self.itemId, self.itemNum, 0, 1000)
                else
                    self:sendBuyToTarget(player)
                end
            else
                player:addGunItem(self.itemId, self.itemNum, 0, 1000)
            end
        else
            player:addItem(self.itemId, self.itemNum, 0)
        end
    else
        MsgSender.sendBottomTipsToTarget(player.rakssid, 2, Messages:msgHaveSameGunTip())
    end
end

function GameExGunNpc:sendBuyToTarget(player)
    local sp = SprayPaintConfig:getSprayPaintByItemId(self.itemId)
    if sp ~= nil then
        HostApi.showConsumeCoinTip(player.rakssid, self.buyHint, 3, sp.price, "BuyExGun=" .. tostring(self.entityId))
    else
        HostApi.sendCustomTip(player.rakssid, self.buyHint, "BuyExGun=" .. tostring(self.entityId))
    end
end

function GameExGunNpc:onPlayerBuy(player)
    local sp = SprayPaintConfig:getSprayPaintByItemId(self.itemId)
    if sp ~= nil then
        if player:updateGunSprayPaint(sp) then
            MsgSender.sendMsgToTarget(player.rakssid, Messages:msgSuccessBuySPTip())
        else
            MsgSender.sendMsgToTarget(player.rakssid, Messages:msgPurchaseFailedTip())
        end
    end
end