---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Jimmy.
--- DateTime: 2019/1/10 0010 21:00
---
require "skill.BaseSkill"

SubSpeedSkill = class("SubSpeedSkill", BaseSkill)
SubSpeedSkill.AttributeType = {
    AddArea = "6071",
    Duration = "6072",
    SubSpeed = "6073"
}

function SubSpeedSkill:onInitAttributeFinish()
    self.players = {}
    local area = self:getAttributeById(AddSpeedSkill.AttributeType.AddArea) / 2
    self.length = self.length + area
    self.width = self.width + area
    self.height = self.height + area
    self.duration = self.duration + self:getAttributeById(AddSpeedSkill.AttributeType.Duration)
    self.damage = self.damage + self:getAttributeById(AddSpeedSkill.AttributeType.SubSpeed)
end

function SubSpeedSkill:onPlayerEffected(player)
    if self.players[tostring(player.userId)] then
        return
    end
    player.addSpeed = player.addSpeed - self.damage
    player:setSpeedAddition(player.addSpeed)
    self.players[tostring(player.userId)] = true
end

function SubSpeedSkill:onDestroy()
    for userId, _ in pairs(self.players) do
        local player = PlayerManager:getPlayerByUserId(userId)
        if player ~= nil then
            player.addSpeed = player.addSpeed + self.damage
            player:setSpeedAddition(player.addSpeed)
        end
    end
    self.players = {}
end

return SubSpeedSkill