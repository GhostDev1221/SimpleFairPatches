---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Jimmy.
--- DateTime: 2019/1/10 0010 17:53
---
require "skill.BaseSkill"

SnowstormSkill = class("SnowstormSkill", BaseSkill)
SnowstormSkill.AttributeType = {
    AddArea = "6111",
    Duration = "6112",
    Damage = "6113"
}

function SnowstormSkill:onInitAttributeFinish()
    self.players = {}
    local area = self:getAttributeById(SnowstormSkill.AttributeType.AddArea) / 2
    self.length = self.length + area
    self.width = self.width + area
    self.height = self.height + area
    self.duration = self.duration + self:getAttributeById(SnowstormSkill.AttributeType.Duration)
    self.damage = self.damage + self:getAttributeById(SnowstormSkill.AttributeType.AddSpeed)
end

function BaseSkill:createSkillEffect(name, time)
    local creator = self:getCreator()
    if #name > 6 and time > 0 then
        local add = self:getAttributeById(SnowstormSkill.AttributeType.Duration) * 1000
        EngineWorld:addSimpleEffect(name, self.initPos, creator:getYaw(), time + add)
    end
end

function SnowstormSkill:onPlayerEffected(player)
    local creator = self:getCreator()
    if not creator then
        return
    end
    player.onSkillDamageUid = creator.userId
    local damage = player:subDefense(self.damage)
    player:subHealth(damage)
    player.onSkillDamageUid = 0
    if player:getHealth() <= 0 then
        self.players[tostring(player.userId)] = nil
        return
    else
        player:setOnFrozen(self.effectCd * 1000 / 2)
    end
end

function SnowstormSkill:onDestroy()
    local creator = self:getCreator()
    if not creator then
        return
    end
    local pos = VectorUtil.newVector3(self.initPos.x, self.initPos.y + 0.3, self.initPos.z)
    EngineWorld:addSimpleEffect("snowstorm_boom.effect", pos, creator:getYaw(), 1000)
end

return SnowstormSkill