---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Administrator.
--- DateTime: 2018/12/22 17:22
---
require "process.BaseProcess"
require "settlement.PersonalSettlement"
require "config.ExtraAwardConfig"

PersonalProcess = class("PersonalProcess", BaseProcess)
PersonalProcess.Index = 1

function PersonalProcess:doWin()
    self.curStatus = self.Status.GameOver
    self.GameOverTick = self.curTick
    local players = PlayerManager:getPlayers()
    for _, player in pairs(players) do
        if player.isLife == false then
            LuaTimer:cancel(player.respawnTaskKey)
        end
    end
    PersonalSettlement:SendSettlementResult(players, 3)
    HostApi.sendStartGame(PlayerManager:getPlayerCount())
end

function PersonalProcess:assignTeam(player)
    player:setTeamId(self.Index)
    self.Index = self.Index + 1
    if self:isRunning() then
        self:teleGamePos(player)
    end
    HostApi.sendShowPixelGunGamePerson(player.rakssid, 0, 0, player.kills)
end

function PersonalProcess:onPlayerQuit(player)
    if self:isGameBegin() and player.isReward == false then
        SeasonManager:addUserHonor(player.userId, GameConfig.quitSubHonor, player.level)
    end
    self:ifClose()
end

function PersonalProcess:showGameInfo(time)
    local players = PlayerManager:getPlayers()
    self:sortPlayers(players)
    for i, v in pairs(players) do
        HostApi.sendShowPixelGunGamePerson(v.rakssid, time, i, v.kills)
    end
end

function PersonalProcess:teleGamePos(player)
    local respawn = RespawnConfig:randomRespawn()
    player:teleportPosWithYaw(respawn.position, respawn.yaw)
    player.isLife = true
end

return PersonalProcess