---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by work.
--- DateTime: 2018/7/9 12:29
---
require "config.Area"

GameGetPublicResource = class()

function GameGetPublicResource:ctor(resource, initPos, yaw, actor, name)
    self.entityId = 0
    self.resource = resource
    self.initPos = initPos
    self.yaw = yaw
    self.actor = actor
    self.name = name
    self.effect = resource.resource.recNpcEffect
    self.isEnter = false
    self.area = {}
    self:onCreate()
end

function GameGetPublicResource:onCreate()
    self.entityId = EngineWorld:addActorNpc(self.initPos, self.yaw, self.actor, "", "idle", self.effect)
    self.area = Area.new(self.resource.resource.area)
    GameManager:onAddGetResource(self)
    self:CreateWall()
end

function GameGetPublicResource:CreateWall()
    local resourcePos = VectorUtil.newVector3i(tonumber(self.initPos.x) - 1, tonumber(self.initPos.y), tonumber(self.initPos.z) - 1)
    for x = 0, 2 do
        for y = 0, 2 do
            local pos = VectorUtil.newVector3i(resourcePos.x + x, self.initPos.y - 1, resourcePos.z + y)
            if x == 1 and y == 1 then
                EngineWorld:setBlock(pos, 155, 7)
            else
                EngineWorld:setBlock(pos, 44, 7)
            end
        end
    end
end

function GameGetPublicResource:inArea(pos)
    return self.area:inArea(pos)
end

function GameGetPublicResource:onPlayerEnter(player)
    if self.isEnter == false then
        MsgSender.sendCenterTipsToTarget(player.rakssid, 2, Messages:enterResource())
        self.isEnter = true
    end
end

function GameGetPublicResource:onPlayerQuit(player)
    self.isEnter = false
end

function GameGetPublicResource:onPlayerHit(player)
    if player:isGetCd(self.resource.resource.getCd, tostring(self.resource.resource.id)) then
        self.resource:getResource(player)
    end
end

function GameGetPublicResource:getPublicResources()
    return self
end

function GameGetPublicResource:removeResource()
    EngineWorld:removeEntity(self.entityId)
end

return GameGetPublicResource