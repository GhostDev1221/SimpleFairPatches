---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by work.
--- DateTime: 2018/8/23 9:57
---
require "base.util.VectorUtil"

Snowman = class()

function Snowman:ctor(team, config)
    self.entityId = nil
    self.teamId = team
    self.config = config
    self.initPos = config.initPos
    self.yaw = config.yaw
    self.actor = config.actor
    self.name = config.name
    self.hp = config.hp
    self.maxhp = config.hp
    self:onCreate()
end

function Snowman:onCreate()
    self.entityId = EngineWorld:addCreatureNpc(VectorUtil.newVector3(unpack(self.initPos)), 1001, self.yaw, self.actor, self.name)
    Match:onAddSnowMan(self)
end

function Snowman:inSameTeam(teamId)
    return self.teamId == teamId
end

function Snowman:attackedByPlayer(fromId, damage)
    self.hp = math.max(0, (self.hp - damage))
    Match:updateTeamSnowHp()
    local players = PlayerManager:getPlayers()
    for _, player in pairs(players) do
        if player.dynamicAttr.team == self.teamId then
            MsgSender.sendTopTipsToTarget(player.rakssid, 2, 1030010)
            if (self.hp < 30) then
                MsgSender.sendTopTipsToTarget(player.rakssid, 5, 1030013)
            end
        end
    end

    if self.hp == 0 then
        Match:step_close_stage(0, self.teamId)
        self:onRemove(fromId)
    end
end

function Snowman:onRemove(fromId)
    Match:onRemoveSnowMan(self)
end

return Snowman